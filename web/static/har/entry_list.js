// Generated by CoffeeScript 1.7.1
(function() {
  define(function(require, exports, module) {
    var analysis, utils;
    analysis = require('/static/har/analysis');
    utils = require('/static/utils');
    return angular.module('entry_list', []).controller('EntryList', function($scope, $rootScope) {
      $scope.filter = {};
      $rootScope.$on('har-loaded', function(ev, data) {
        console.log(data);
        $scope.filename = data.filename;
        $scope.har = data.har;
        $scope.env = utils.dict2list(data.env);
        $scope.session = [];
        utils.storage.set('har_filename', data.filename);
        utils.storage.set('har_har', data.har);
        utils.storage.set('har_env', data.env);
        $scope.recommend();
        return $scope.filter.recommend = true;
      });
      $scope.$on('har-change', function() {
        return $scope.save_change();
      });
      $scope.save_change = utils.debounce((function() {
        if ($scope.filename) {
          console.log('local saved');
          return utils.storage.set('har_har', $scope.har);
        }
      }), 1000);
      $scope.status_label = function(status) {
        if (Math.floor(status / 100) === 2) {
          return 'label-success';
        } else if (Math.floor(status / 100) === 3) {
          return 'label-info';
        } else if (status === 0) {
          return 'label-danger';
        } else {
          return 'label-warning';
        }
      };
      $scope.variables_in_entry = analysis.variables_in_entry;
      $scope.badge_filter = function(update) {
        var filter, key, value;
        filter = angular.copy($scope.filter);
        for (key in update) {
          value = update[key];
          filter[key] = value;
        }
        return filter;
      };
      $scope.track_item = function() {
        $scope.filted = [];
        return function(item) {
          $scope.filted.push(item);
          return true;
        };
      };
      $scope.edit = function(entry) {
        $scope.$broadcast('edit-entry', entry);
        return false;
      };
      return $scope.recommend = function() {
        return analysis.recommend($scope.har);
      };
    });
  });

}).call(this);
